{"version":3,"file":"pausable.js","sourceRoot":"","sources":["../../test/pausable.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  DTXTokenContract,\n  DTXTokenInstance,\n  DXCDealsContract,\n  DXCDealsInstance,\n  DXCTokensContract,\n  DXCTokensInstance,\n  MiniMeTokenFactoryContract,\n  MiniMeTokenFactoryInstance,\n  OwnedUpgradeabilityProxyContract,\n  OwnedUpgradeabilityProxyInstance,\n} from '../types/truffle-contracts';\n\nconst TF: MiniMeTokenFactoryContract = artifacts.require('MiniMeTokenFactory');\nconst DTX: DTXTokenContract = artifacts.require('DTXToken');\nconst DXCTokens: DXCTokensContract = artifacts.require('DXCTokens');\nconst DXCDeals: DXCDealsContract = artifacts.require('DXCDeals');\nconst OUP: OwnedUpgradeabilityProxyContract = artifacts.require(\n  'OwnedUpgradeabilityProxy'\n);\n\ncontract('Pausable', accounts => {\n  describe('Test pausable functionalities', () => {\n    let proxiedTokensDxc: DXCTokensInstance;\n    let proxiedDealsDxc: DXCDealsInstance;\n    before('Init env', async () => {\n      const tfInstance: MiniMeTokenFactoryInstance = await TF.new();\n      const dtxInstance: DTXTokenInstance = await DTX.new(tfInstance.address);\n      const dxcTokensInstance: DXCTokensInstance = await DXCTokens.new();\n      const dxcDealsInstance: DXCDealsInstance = await DXCDeals.new();\n      const oUPDealsinstance: OwnedUpgradeabilityProxyInstance = await OUP.new();\n      const oUPTokensinstance: OwnedUpgradeabilityProxyInstance = await OUP.new();\n\n      // point proxy contract to dxc contract and call the initialize function which is analogous to a constructor\n      assert.isOk(\n        await oUPTokensinstance.upgradeTo(dxcTokensInstance.address, {\n          from: accounts[0],\n        })\n      );\n\n      assert.isOk(\n        await oUPDealsinstance.upgradeTo(dxcDealsInstance.address, {\n          from: accounts[0],\n        })\n      );\n\n      // Intitialize the proxied dxc instance\n      proxiedTokensDxc = await DXCTokens.at(oUPTokensinstance.address);\n      await proxiedTokensDxc.initialize(\n        dtxInstance.address,\n        proxiedDealsDxc.address\n      );\n\n      proxiedDealsDxc = await DXCDeals.at(oUPDealsinstance.address);\n      await proxiedDealsDxc.initialize(proxiedTokensDxc.address);\n    });\n\n    it('Initial state cannot be changed', async () => {\n      try {\n        await proxiedTokensDxc.initPause();\n      } catch (error) {\n        error.toString().includes('Transaction reverted');\n      }\n    });\n\n    it('When not paused everything works as expected', async () => {\n      assert.isFalse(await proxiedTokensDxc.paused());\n      assert.isOk(await proxiedTokensDxc.changeProtocolPercentage(10));\n    });\n\n    it('Revert when paused', async () => {\n      assert.isOk(await proxiedTokensDxc.pause());\n      assert.isTrue(await proxiedTokensDxc.paused());\n      try {\n        await proxiedTokensDxc.changeProtocolPercentage(5);\n      } catch (error) {\n        error.toString().includes('paused');\n      }\n      assert.isOk(await proxiedTokensDxc.unpause());\n      assert.isOk(await proxiedTokensDxc.changeProtocolPercentage(12));\n      assert.equal(\n        await (await proxiedTokensDxc.protocolPercentage()).toString(),\n        '12'\n      );\n    });\n\n    it('Only owner can pause', async () => {\n      try {\n        await proxiedTokensDxc.pause({from: accounts[1]});\n      } catch (error) {\n        error.toString().includes('caller is not the owner');\n      }\n    });\n  });\n});\n"]}